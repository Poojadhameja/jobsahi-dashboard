// âœ… FIXED CODE - Replace the ownership verification section with this:

if ($user_role === 'recruiter') {
    // Step 1: Get recruiter_profile_id from logged-in user_id
    $rp = $conn->prepare("SELECT id FROM recruiter_profiles WHERE user_id = ?");
    $rp->bind_param("i", $user_id);
    $rp->execute();
    $rp_res = $rp->get_result();
    
    if ($rp_res->num_rows === 0) {
        echo json_encode(["status" => false, "message" => "Recruiter profile not found"]);
        exit();
    }

    $recruiter_profile_id = intval($rp_res->fetch_assoc()['id']);

    // Step 2: Verify interview ownership - TRY THESE OPTIONS ONE BY ONE
    
    // OPTION 1: If interviews table has recruiter_id directly (MOST LIKELY)
    $check = $conn->prepare("
        SELECT id 
        FROM interviews
        WHERE id = ? AND recruiter_id = ?
    ");
    $check->bind_param("ii", $interview_id, $recruiter_profile_id);
    $check->execute();
    $result = $check->get_result();
    
    // If Option 1 doesn't work, try Option 2:
    // OPTION 2: Join through application_id (if it exists and is NOT NULL)
    /*
    $check = $conn->prepare("
        SELECT i.id 
        FROM interviews i
        INNER JOIN applications a ON i.application_id = a.id AND i.application_id IS NOT NULL
        INNER JOIN jobs j ON a.job_id = j.id
        WHERE i.id = ? AND j.recruiter_id = ?
    ");
    $check->bind_param("ii", $interview_id, $recruiter_profile_id);
    $check->execute();
    $result = $check->get_result();
    */
    
    // If Option 2 doesn't work, try Option 3:
    // OPTION 3: Join through student_id to applications
    /*
    $check = $conn->prepare("
        SELECT i.id 
        FROM interviews i
        INNER JOIN applications a ON i.student_id = a.student_id
        INNER JOIN jobs j ON a.job_id = j.id
        WHERE i.id = ? AND j.recruiter_id = ?
    ");
    $check->bind_param("ii", $interview_id, $recruiter_profile_id);
    $check->execute();
    $result = $check->get_result();
    */

    if ($result->num_rows === 0) {
        echo json_encode([
            "status" => false,
            "message" => "Unauthorized or invalid interview ID"
        ]);
        exit();
    }
}

